<div class="ai-assistant-container">
  <header class="ai-assistant-header">
    <div class="header-title">
      <div class="title-row">
        <h2>AI Assistant</h2>
      </div>
      <div class="model-selector-container">
        <select [(ngModel)]="selectedModel">
          @for (model of models; track model) {
            <option [value]="model.id">{{ model.name }}</option>
          }
        </select>
      </div>
    </div>
    <div class="header-actions">
      <button class="expand-button" (click)="toggleExpanded()">
        <span class="material-symbols-outlined">
          @if (isExpanded()) {
            close_fullscreen
          } @else {
            open_in_full
          }
        </span>
      </button>
      <button class="close-button" (click)="close.emit()">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
  </header>
  <div class="ai-assistant-body">
    <div class="messages-container" #messagesContainer>
      @for (message of messages; track $index) {
        <div
          class="message"
          [class.user-message]="message.role === 'user'"
          [class.model-message]="message.role === 'model'"
        >
          <div [innerHTML]="message.text"></div>
        </div>
      }
      @if (isLoading()) {
        <div class="message model-message">
          <message-spinner message="Thinking..." />
        </div>
      }
    </div>
    <div class="input-container">
      <textarea
        #userInputElement
        [ngModel]="userInput()"
        (ngModelChange)="userInput.set($event)"
        placeholder="Ask a question about the report..."
        (keydown.enter)="$event.preventDefault(); send()"
        [readonly]="isLoading()"
      ></textarea>
      <button (click)="send()" [disabled]="isLoading()">
        <span class="material-symbols-outlined">send</span>
      </button>
    </div>
  </div>
</div>
